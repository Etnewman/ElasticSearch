################### Metricbeat Configuration For Windows ######################
# DCGS metricbeat configuration for generic windows boxes
#
# You can find the full configuration reference here:
# https://www.elastic.co/guide/en/beats/metricbeat/index.html

#==========================  Modules configuration ============================

metricbeat.config.modules:
  # Glob pattern for configuration loading
  path: ${path.config}/modules.d/*.yml

  # Set to true to enable config reloading
  reload.enabled: false

  # Period on which files under path should be checked for changes
  #reload.period: 10s

logging.level: error

# ================================= Processors =================================
# Configure processors to enhance or manipulate events generated by the beat.
#
# The appmonitor processor will pull key metrics from different metricsets and
# evalualte the health of applications by looking at the services/processes that
# are needed for the application to be healty

processors:
  - script:
      lang: javascript
      id: App_Monitor
      file: ./appmonitor_win.js
      params:
        not_justStarted: false
        metrics:
          {
            'cpu': { 'curval': 0.0, 'threshold': .90 },
            'memory': { 'curval': 0.0, 'threshold': .95 },
            'filesystem':
              { 'curval': 0.0, 'threshold': .90, 'mount_point': 'none' },
          }
        network: { 'curBytesin': 0, 'curBytesout': 0 }
        apps:
          {
            'McAfee_Agent':
              {
                'hosteffect': 'Degraded',
                'services':
                  {
                    'macmnsvc': { 'running': false, 'effect': 'Down' },
                    'masvc': { 'running': false, 'effect': 'Down' },
                  },
              },
            'McAfee_EndPoint':
              {
                'hosteffect': 'Degraded',
                'services':
                  { 'mfemms': { 'running': false, 'effect': 'Down' } },
                'processes':
                  { 'mfetp': { 'running': false, 'effect': 'Down' } },
              },
            'SCCM_Distribution_Point':
              {
                'hosteffect': 'Down',
                'services':
                  {
                    'IISADMIN': { 'running': false, 'effect': 'Down' },
                    'W3SVC': { 'running': false, 'effect': 'Down' },
                    'Winmgmt': { 'running': false, 'effect': 'Down' },
                    'CcmExec': { 'running': false, 'effect': 'Degraded' },
                  },
              },
          }
#----------------------------- Logstash output --------------------------------
