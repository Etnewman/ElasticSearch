################### Metricbeat Configuration For Windows ######################
# DCGS metricbeat configuration for generic windows boxes
#
# You can find the full configuration reference here:
# https://www.elastic.co/guide/en/beats/metricbeat/index.html

#==========================  Modules configuration ============================

metricbeat.config.modules:
  # Glob pattern for configuration loading
  path: ${path.config}/modules.d/*.yml

  # Set to true to enable config reloading
  reload.enabled: false

  # Period on which files under path should be checked for changes
  #reload.period: 10s

logging.level: error

# ================================= Processors =================================
# Configure processors to enhance or manipulate events generated by the beat.
#
# The appmonitor processor will pull key metrics from different metricsets and
# evalualte the health of applications by looking at the services/processes that
# are needed for the application to be healty

processors:
  - script:
      lang: javascript
      id: App_Monitor
      file: ./appmonitor_win.js
      params:
        not_justStarted: false
        metrics:
          {
            'cpu': { 'curval': 0.0, 'threshold': .90 },
            'memory': { 'curval': 0.0, 'threshold': .95 },
            'filesystem':
              { 'curval': 0.0, 'threshold': .90, 'mount_point': 'none' },
          }
        network: { 'curBytesin': 0, 'curBytesout': 0 }
        apps:
          {
            'McAfee_Agent':
              {
                'hosteffect': 'Degraded',
                'services':
                  {
                    'macmnsvc': { 'running': false, 'effect': 'Down' },
                    'masvc': { 'running': false, 'effect': 'Down' },
                  },
              },
            'McAfee_EndPoint':
              {
                'hosteffect': 'Degraded',
                'services':
                  { 'mfemms': { 'running': false, 'effect': 'Down' } },
                'processes':
                  { 'mfetp': { 'running': false, 'effect': 'Down' } },
              },
            'AD-DNS_AD_DNS':
              {
                'hosteffect': 'Down',
                'services':
                  {
                    'adws': { 'running': false, 'effect': 'Degraded' },
                    'ntds': { 'running': false, 'effect': 'Down' },
                    'dns': { 'running': false, 'effect': 'Down' },
                    'kdc': { 'running': false, 'effect': 'Down' },
                    'netlogon': { 'running': false, 'effect': 'Down' },
                    'nsi': { 'running': false, 'effect': 'Down' },
                    'rpcss': { 'running': false, 'effect': 'Down' },
                    'rpceptmapper': { 'running': false, 'effect': 'Down' },
                    'samss': { 'running': false, 'effect': 'Down' },
                    'dnscache': { 'running': false, 'effect': 'Down' },
                    'w32time': { 'running': false, 'effect': 'Down' },
                    'brokerinfrastructure':
                      { 'running': false, 'effect': 'Degraded' },
                    'bfe': { 'running': false, 'effect': 'Degraded' },
                    'eventsystem': { 'running': false, 'effect': 'Degraded' },
                    'cryptsvc': { 'running': false, 'effect': 'Degraded' },
                    'dcomlaunch': { 'running': false, 'effect': 'Degraded' },
                    'dfsr': { 'running': false, 'effect': 'Degraded' },
                    'dfs': { 'running': false, 'effect': 'Degraded' },
                    'dhcp': { 'running': false, 'effect': 'Degraded' },
                    'ismserv': { 'running': false, 'effect': 'Degraded' },
                    'lsm': { 'running': false, 'effect': 'Degraded' },
                    'nlasvc': { 'running': false, 'effect': 'Degraded' },
                    'sens': { 'running': false, 'effect': 'Degraded' },
                    'schedule': { 'running': false, 'effect': 'Degraded' },
                    'profsvc': { 'running': false, 'effect': 'Degraded' },
                    'eventlog': { 'running': false, 'effect': 'Degraded' },
                    'mpssvc': { 'running': false, 'effect': 'Degraded' },
                    'winmgmt': { 'running': false, 'effect': 'Degraded' },
                    'winrm': { 'running': false, 'effect': 'Degraded' },
                    'dps': { 'running': false, 'effect': 'Degraded' },
                    'efs': { 'running': false, 'effect': 'Degraded' },
                    'gpsvc': { 'running': false, 'effect': 'Degraded' },
                    'systemeventsbroker':
                      { 'running': false, 'effect': 'Degraded' },
                    'wersvc': { 'running': false, 'effect': 'Degraded' },
                  },
              },
          }
#----------------------------- Logstash output --------------------------------
